<!DOCTYPE html>
<html>
    <head>
        <title> Carpark Lots </title>
    </head>
<body>

<h1>Lab 3: Carpark Utilization Table</h1>

<p></p>
<div id = "main"> </div>
<table id="lots" border="1">
    <thead>
        <tr>
            <th>Carpark Number</th>
            <th>Timestamp</th>
            <th>Lot Type</th>
            <th>Total Lots</th>
            <th>Lot availability</th>
            <th>Utilization</th>
        </tr>
    </thead>
    <tbody>

    </tbody>
    
</table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    
let myData = {};
    
fetch('https://api.data.gov.sg/v1/transport/carpark-availability')
    .then(response => response.json())
    .then(data => {
        myData = data;
        console.log(myData);
        sortData(myData);
    }); 


function sortData(data) {
    var out = '', total, lotTotal, lotAva;
    

    total = data.items[0].carpark_data.length;

    for (i = 0; i < total; i++) {
        lotTotal = data.items[0].carpark_data[i].carpark_info[0].total_lots;
        lotAva = data.items[0].carpark_data[i].carpark_info[0].lots_available;
        out += "<tr><td>" 
            + data.items[0].carpark_data[i].carpark_number + "</td><td>" 
            + data.items[0].carpark_data[i].update_datetime + "</td><td>"
            + data.items[0].carpark_data[i].carpark_info[0].lot_type + "</td><td>"
            + data.items[0].carpark_data[i].carpark_info[0].total_lots + "</td><td>"
            + data.items[0].carpark_data[i].carpark_info[0].lots_available + "</td><td>" 
            + Math.ceil(((lotTotal-lotAva)/lotTotal)*100); 
            + "</td></tr>"
    }

    $('tbody').append(out);

}

</script>

</body>
</html>